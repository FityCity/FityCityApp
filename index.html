<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
    <title></title>

    <link href="lib/ionic/css/ionic.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/login.css" rel="stylesheet" type="text/css"/>
    <!-- IF using Sass (run gulp sass first), then uncomment below and remove the CSS includes above
    <link href="css/ionic.app.css" rel="stylesheet">
    -->

    <!-- ionic/angularjs js -->
    <script src="lib/jquery/jquery.min.js"></script>
    <script src="lib/ionic/js/ionic.bundle.js"></script>
    <script src="lib/ionic/js/ionic.swipecards.js"></script>

    <!-- cordova script (this will be a 404 during development) -->
    <script src="cordova.js"></script>

    <!-- your app's js -->
    <script src="js/services.js"></script>
    <script src="js/controllers.js"></script>
    <script src="js/app.js"></script>
    <script src="lib/com.fitecity/video/video.js"></script>
    <script src="js/plugins/facebook/facebookConnectPlugin.js" type="text/javascript"></script>
	<script type="text/javascript" charset="utf-8" src="PushNotification.js"></script>
    <script>
      function onDeviceReady() {
        setTimeout(function() {
          navigator.splashscreen.hide();
        }, 3000);
		console.log(navigator);
                //Push Notification Code
                pushNotification = window.plugins.pushNotification;

                $("#app-status-ul").append('<li>registering ' + device.platform + '</li>');
                if (device.platform == 'android' || device.platform == 'Android' || device.platform == "amazon-fireos") {
                    pushNotification.register(
                        successHandler,
                        errorHandler,
                        {
                                "senderID": "702772774891", //sender_id
                                "ecb": "onNotification"
                            });
                } else if (device.platform == 'blackberry10') {
                    pushNotification.register(
                        successHandler,
                        errorHandler,
                        {
                            invokeTargetId: "replace_with_invoke_target_id",
                            appId: "replace_with_app_id",
                                ppgUrl: "replace_with_ppg_url", //remove for BES pushes
                                ecb: "pushNotificationHandler",
                                simChangeCallback: replace_with_simChange_callback,
                                pushTransportReadyCallback: replace_with_pushTransportReady_callback,
                                launchApplicationOnPush: true
                            });
                } else {
                    pushNotification.register(
                        tokenHandler,
                        errorHandler,
                        {
                            "badge": "true",
                            "sound": "true",
                            "alert": "true",
                            "ecb": "onNotificationAPN"
                        });
                }
                // Android and Amazon Fire OS
                window.onNotification = function(e) {
                    $("#app-status-ul").append('<li>EVENT -> RECEIVED:' + e.event + '</li>');
                    console.log('EVENT -> RECEIVED:' + e.event);
                    switch (e.event)
                    {
                        case 'registered':
                        if (e.regid.length > 0)
                        {
                            $("#app-status-ul").append('<li>REGISTERED -> REGID:' + e.regid + "</li>");
                                // Your GCM push server needs to know the regID before it can push to this device
                                // here is where you might want to send it the regID for later use.
                                console.log("regID = " + e.regid);
                                
                                $.post("http://fitecity.herokuapp.com/register",
                                  {
                                    device_id:e.regid
                                    //city:"Duckburg"
                                  },
                                  function(data,status){
                                    console.log("Data: " + data + "\nStatus: " + status);
                                  });

                                // $http({
                                //     method: 'POST',
                                //     url: 'http://fitecity.herokuapp.com/register',
                                //     data: "devide id:" + e.regid,
                                //     headers: {'Content-Type': 'application/x-www-form-urlencoded'}
                                // }).
                                //     then(function(result){
                                //         console.log('Sent RegId' +result);
                                //     },
                                //     function(err){
                                //         console.log('Error in Sending RegId' +err);
                                //     });
                            }
                            break;

                            case 'message':
                            // if this flag is set, this notification happened while we were in the foreground.
                            // you might want to play a sound to get the user's attention, throw up a dialog, etc.
                            if (e.foreground)
                            {
                                $("#app-status-ul").append('<li>--INLINE NOTIFICATION--' + '</li>');

                                // on Android soundname is outside the payload.
                                // On Amazon FireOS all custom attributes are contained within payload
                                //var soundfile = e.soundname || e.payload.sound;
                                // if the notification contains a soundname, play it.
                                //var my_media = new Media("/android_asset/www/" + soundfile);
                                //my_media.play();
                                console.log('INLINE NOTIFICATION');
                                alert('New Offer is Added');
                            }
                            else
                            {  // otherwise we were launched because the user touched a notification in the notification tray.
                                if (e.coldstart)
                                {
                                    $("#app-status-ul").append('<li>--COLDSTART NOTIFICATION--' + '</li>');
                                    console.log('Received COLDSTART NOTIFICATION');
                                    alert('New Offer is Added');
                                }
                                else
                                {
                                    $("#app-status-ul").append('<li>--BACKGROUND NOTIFICATION--' + '</li>');
                                    console.log('Received BACKGROUND NOTIFICATION');
                                    alert('New Offer is Added');
                                }
                            }

                            //$("#app-status-ul").append('<li>MESSAGE -> MSG: ' + e.payload.message + '</li>');
                            //Only works for GCM
                            //$("#app-status-ul").append('<li>MESSAGE -> MSGCNT: ' + e.payload.msgcnt + '</li>');
                            
                            //Only works on Amazon Fire OS
                            //$status.append('<li>MESSAGE -> TIME: ' + e.payload.timeStamp + '</li>');
                            break;

                            case 'error':
                            $("#app-status-ul").append('<li>ERROR -> MSG:' + e.msg + '</li>');
                            console.log('ERROR -> MSG:' + e.msg);
                            break;

                            default:
                            $("#app-status-ul").append('<li>EVENT -> Unknown, an event was received and we do not know what it is</li>');
                            console.log('Unknown event');
                            break;
                        }
                    }
                // result contains any message sent from the plugin call
                function successHandler(result) {
                    console.log('result = ' + result);
                }
                // result contains any error description text returned from the plugin call
                function errorHandler(error) {
                    console.log('error = ' + error);
                }
                // iOS
                function onNotificationAPN(event) {
                    if (event.alert)
                    {
                        navigator.notification.alert(event.alert);
                    }

                    if (event.sound)
                    {
                        var snd = new Media(event.sound);
                        snd.play();
                    }

                    if (event.badge)
                    {
                        pushNotification.setApplicationIconBadgeNumber(successHandler, errorHandler, event.badge);
                    }
                }
      }
      document.addEventListener("deviceready",onDeviceReady,false);
    </script>

  </head>
  <body ng-app="starter" animation="slide-left-right-ios7">
      <div id="fb-root"></div>
    <!-- 
      The nav bar that will be updated as we navigate between views.
    -->
    <ion-nav-bar class="bar bar-header nav-title-slide-ios7 bar-positive">
      <ion-nav-back-button class="button-icon icon  ion-ios7-arrow-back">
        Back
      </ion-nav-back-button>
    </ion-nav-bar>
    
    <!-- 
      The views will be rendered in the <ion-nav-view> directive below
      Templates are in the /templates folder (but you could also
      have templates inline in this html file if you'd like).
    -->
    <ion-nav-view></ion-nav-view>
  </body>
</html>
